<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>MCP Chat Embed Tester</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: #f5f6f9;
        color: #111827;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      header,
      section {
        width: min(960px, 100%);
        margin: 24px auto;
        padding: 24px;
        background: #ffffff;
        border-radius: 16px;
        box-shadow: 0 12px 32px rgba(15, 23, 42, 0.08);
      }

      header h1 {
        margin: 0 0 12px;
        font-size: 1.6rem;
      }

      header p {
        margin: 4px 0;
        color: #4b5563;
      }

      label {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 16px;
        font-size: 0.95rem;
        color: #374151;
      }

      input,
      textarea {
        border: 1px solid #d1d5db;
        border-radius: 10px;
        padding: 12px 14px;
        font-size: 1rem;
        font-family: inherit;
      }

      textarea {
        min-height: 80px;
        resize: vertical;
      }

      button {
        border: none;
        border-radius: 999px;
        padding: 12px 24px;
        font-size: 0.95rem;
        background: linear-gradient(135deg, #2563eb, #7c3aed);
        color: #ffffff;
        cursor: pointer;
        box-shadow: 0 10px 24px rgba(59, 130, 246, 0.25);
      }

      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        box-shadow: none;
      }

      iframe {
        width: 100%;
        min-height: 720px;
        border: 1px solid #e5e7eb;
        border-radius: 18px;
        box-shadow: 0 20px 40px rgba(15, 23, 42, 0.12);
      }
    </style>
  </head>
  <body>
    <header>
      <h1>MCP Chat Embed Tester</h1>
      <p>
        This page embeds the chat UI to validate <code>postMessage</code> communication from the host
        page.
      </p>
      <p>
        Default iframe source:
        <code>http://localhost:5174/?embed=1&amp;mcp=https://temple-unstrenuous-milena.ngrok-free.dev/mcp</code>
      </p>
    </header>

    <section>
      <label>
        Iframe URL
        <input
          id="iframe-src"
          type="url"
          value="http://localhost:5174/?embed=1&amp;mcp=https://temple-unstrenuous-milena.ngrok-free.dev/mcp"
        />
      </label>
      <button id="reload-iframe">Reload iframe</button>
    </section>

    <section>
      <label>
        Prompt to inject
        <textarea id="prompt">请帮我列出最近的部署变更。</textarea>
      </label>
      <div style="display: flex; gap: 12px; align-items: center;">
        <button id="send-prompt">Send Prompt</button>
        <button id="clear-prompt" style="background: #6b7280;">Clear Prompt</button>
      </div>
    </section>

    <section>
      <iframe
        id="embed-frame"
        src="http://localhost:5174/?embed=1&amp;mcp=https://temple-unstrenuous-milena.ngrok-free.dev/mcp"
        allow="clipboard-read; clipboard-write"
      ></iframe>
    </section>

    <script>
      const iframe = document.getElementById('embed-frame');
      const inputField = document.getElementById('prompt');
      const srcField = document.getElementById('iframe-src');

      function postPrompt(text) {
        try {
          iframe.contentWindow?.postMessage(
            { type: 'mcp-chat:setInput', text, focus: true },
            '*',
          );
        } catch (error) {
          console.error('Failed to post message to iframe', error);
          alert('Unable to post message. Check the console for details.');
        }
      }

      document.getElementById('send-prompt').addEventListener('click', () => {
        postPrompt(inputField.value);
      });

      document.getElementById('clear-prompt').addEventListener('click', () => {
        postPrompt('');
      });

      document.getElementById('reload-iframe').addEventListener('click', () => {
        iframe.src = srcField.value || iframe.src;
      });
    </script>
  </body>
</html>
